### Ubuntu Server (OpenConnect) ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ AnyConnect‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ VPN (DTLS/UDP)

–ù–∞ Ubuntu Server –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **OpenConnect**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç VPN, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å AnyConnect, –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **DTLS (UDP)**, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä/—Å–µ—Ç—å —ç—Ç–æ —Ä–∞–∑—Ä–µ—à–∞—é—Ç (–∏–Ω–∞—á–µ –±—É–¥–µ—Ç fallback –Ω–∞ TLS/TCP).

–í —ç—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å:
- `openconnect_udp.py` ‚Äî Python-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- `openconnect_manager.sh` ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `anyful.sh` ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OpenConnect —Å–µ—Ä–≤–µ—Ä–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ubuntu Server
- Python 3
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `openconnect`

## üìã –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üéØ –°–ø–æ—Å–æ–± 1: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `openconnect_manager.sh` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é:

```bash
chmod +x openconnect_manager.sh
./openconnect_manager.sh
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPN —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç VPN
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –∏ ASCII-–∞—Ä—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–°–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `~/.openconnect_config` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

### üîß –°–ø–æ—Å–æ–± 2: –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Python-—Å–∫—Ä–∏–ø—Ç–∞

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å OpenConnect:

```bash
sudo apt-get update
sudo apt-get install -y openconnect
```

–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è (DTLS/UDP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω; –∏–Ω–∞—á–µ –±—É–¥–µ—Ç fallback –Ω–∞ TLS/TCP):

```bash
sudo python3 openconnect_udp.py connect vpn.example.com
```

–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è:

```bash
sudo python3 openconnect_udp.py disconnect
```

–°—Ç–∞—Ç—É—Å:

```bash
python3 openconnect_udp.py status
```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –∑–∞–∫—Ä–µ–ø–∏—Ç—å (pin) —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ–ø—Ä–æ—Å–∏—Ç–µ pin —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞), –Ω–∞–ø—Ä–∏–º–µ—Ä:

```bash
sudo python3 openconnect_udp.py connect vpn.example.com --servercert "pin-sha256:BASE64..."
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TCP (–æ—Ç–∫–ª—é—á–∏—Ç—å DTLS/UDP):

```bash
sudo python3 openconnect_udp.py connect vpn.example.com --no-dtls
```

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è / —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

- –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–±—ã—á–Ω–æ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ root (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sudo`), —Ç.–∫. —Å–æ–∑–¥–∞—ë—Ç—Å—è TUN‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
- –ï—Å–ª–∏ UDP/DTLS –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —Å–µ—Ç—å—é –∏–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ), OpenConnect –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ TLS/TCP.

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–æ–≤

| –§—É–Ω–∫—Ü–∏—è | `openconnect_manager.sh` | `openconnect_udp.py` |
|---------|-------------------------|---------------------|
| –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | ‚ùå –í—Ä—É—á–Ω—É—é |
| –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ | ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π | ‚ùå –í—Ä—É—á–Ω—É—é |
| –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | ‚ùå –í—Ä—É—á–Ω—É—é |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö | ‚ö†Ô∏è –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è | ‚úÖ –î–∞ |
| –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è | ‚ö†Ô∏è –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è | ‚úÖ –î–∞ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `openconnect_manager.sh` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ `openconnect_udp.py` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤.

## üñ•Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenConnect —Å–µ—Ä–≤–µ—Ä–∞

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **—Å–µ—Ä–≤–µ—Ä** OpenConnect (ocserv), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `anyful.sh`:

```bash
chmod +x anyful.sh
sudo ./anyful.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ocserv
- –°–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –∏ firewall

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –§–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

- **`openconnect_udp.py`** ‚Äî Python-—Å–∫—Ä–∏–ø—Ç –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPN
- **`openconnect_manager.sh`** ‚Äî Bash-—Å–∫—Ä–∏–ø—Ç —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–µ–Ω—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–º
- **`anyful.sh`** ‚Äî Bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ OpenConnect

### –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `openconnect_manager.sh` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `~/.openconnect_config`. –ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:

```bash
VPN_SERVER="vpn.example.com"
VPN_USERNAME="myusername"
VPN_AUTHGROUP="GroupName"
VPN_INTERFACE="tun0"
VPN_SERVERCERT="pin-sha256:BASE64..."
NO_DTLS="false"
VPN_LOG_FILE="/var/log/openconnect.log"
EXTRA_ARGS=""
```

### PID —Ñ–∞–π–ª

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `/run/openconnect_anyconnect.pid` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.


